<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>HOTKEY QUIZ</title>
<style>
    body {
        font-family: 'Segoe UI', sans-serif;
        background: linear-gradient(135deg, #4facfe, #00f2fe);
        color: #fff;
        text-align: center;
        margin: 0;
        padding: 0;
    }
    .container {
        max-width: 600px;
        margin: 80px auto;
        background: rgba(0, 0, 0, 0.4);
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 8px 16px rgba(0,0,0,0.3);
    }
    h1 { font-size: 28px; margin-bottom: 20px; }
    #question { font-size: 22px; margin-bottom: 20px; }
    #result { font-size: 20px; margin-top: 15px; }
    #score { font-size: 22px; margin-top: 20px; font-weight: bold; }
    .hint { font-size: 14px; margin-top: 10px; color: #ddd; }
</style>
</head>
<body>
<div class="container">
    <h1>ENSITE HOTKEY QUIZ</h1>
    <div id="question"></div>
    <div class="hint">※ 実際にキーを押してください（F1~12の場合はfnキーも押してください）</div>
    <div id="result"></div>
    <div id="score"></div>
</div>

<script>
const questions = [
    { q: "イベントを保存", a: "Control+E" },
    { q: "Bookmarkを保存", a: "Control+B" },
    { q: "Studyの終了", a: "Control+Q" },
    { q: "ヘルプダイアログの表示", a: "F1" },
    { q: "スプリットスクリーンをシンクロ", a: "F3" },
    { q: "Voxelポイントの表示/非表示", a: "Control+K" },
    { q: "呼吸データの収集", a: "Alt+R" },
    { q: "セグメントの記録", a: "F4" },
    { q: "Active EnGuideでリージョンを追加", a: "F6" },
    { q: "Active EnGuideで3Dリージョンを追加", a: "Shift+F6" },
    { q: "APを中心に後方に回転", a: "W" }, // 単独キー対応
    { q: "APを中心に前方に回転", a: "S" },
    { q: "APを中心とした左方向への回転", a: "A" },
    { q: "APを中心とした右方向への回転", a: "D" },
    { q: "消しゴムツールのサンドペーパーによる補正", a: "F2" },
    { q: "消しゴムツールの種類の切替", a: "Z" },
    { q: "モデルポイント削除の取消", a: "Control+Z" },
    { q: "モデルの作成/AutoMapによるデータ収集の停止", a: "F9" },
    { q: "Mapping PointのFreeze/保存", a: "F11" },
    { q: "現在のMapping Pointの破棄", a: "F12" },
    { q: "AutoMapの開始/停止", a: "Shift+F11" },
    { q: "ビートバッファの後退", a: "ArrowLeft" },
    { q: "ビートバッファの前進", a: "ArrowRight" },
    { q: "ツールリストを開く/閉じる", a: "O" },
    { q: "ローテート/パン", a: "R" },
    { q: "ポインター", a: "P" },
    { q: "Shadow", a: "H" },
    { q: "Marker", a: "M" },
    { q: "Tape Measure", a: "T" },
    { q: "Caliper", a: "C" },
    { q: "Label", a: "B" },
    { q: "Lesion", a: "L" },
    { q: "リストの前のポイントを選択", a: "ArrowUp" },
    { q: "リストの次のポイントを選択", a: "ArrowDown" },
    { q: "前のポイントグループを選択", a: "Alt+ArrowUo" },
    { q: "次のポイントグループを選択", a: "Alt+ArrowDown" },
    { q: "リストの最初のポイントを選択", a: "Home" },
    { q: "リストの最後のポイントを選択", a: "End" },
    { q: "すべてのポイントを選択", a: "Control+A" },
    { q: "グループ内のすべてのポイントを選択", a: "Control+G" },
    { q: "グループ内のすべてのポイントを既存の選択範囲に追加", a: "Control+Shift+G" },
    { q: "選択されたポイントを削除", a: "Delete" },
    { q: "ポイントグループを削除", a: "Alt+Delete" },
    { q: "選択したポイントへのスクロール", a: "Alt+Home" },
    { q: "選択したポイントをMapに表示", a: "Control+L" },
];

let shuffled = questions.sort(() => Math.random() - 0.5);
let index = 0;
let score = 0;
let pressedKeys = new Set();
let comboHistory = [];

function showQuestion() {
    if (index < shuffled.length) {
        document.getElementById("question").textContent = `問題 ${index+1}: ${shuffled[index].q}`;
        document.getElementById("result").textContent = "";
        pressedKeys.clear();
        comboHistory = [];
    } else {
        document.getElementById("question").textContent = "テスト終了！";
        document.getElementById("score").textContent = `あなたのスコア: ${score}/${shuffled.length}`;
        document.removeEventListener("keydown", handleKeyDown);
        document.removeEventListener("keyup", handleKeyUp);
    }
}

function handleKeyDown(e) {
    e.preventDefault(); // ブラウザのデフォルト動作を防止
    pressedKeys.add(e.code);
    if (!comboHistory.includes(e.code)) {
        comboHistory.push(e.code);
    }
}

function handleKeyUp(e) {
    pressedKeys.delete(e.code);
    if (pressedKeys.size === 0) {
        // 判定はすべてのキーが離されたタイミング
        const combo = [];
        if (comboHistory.includes("ControlLeft") || comboHistory.includes("ControlRight")) combo.push("Control");
        if (comboHistory.includes("ShiftLeft") || comboHistory.includes("ShiftRight")) combo.push("Shift");
        if (comboHistory.includes("AltLeft") || comboHistory.includes("AltRight")) combo.push("Alt");

        // 修飾キー以外の最後のキーを追加
        const nonModifierKeys = comboHistory.filter(k => !k.includes("Control") && !k.includes("Shift") && !k.includes("Alt"));
        if (nonModifierKeys.length > 0) {
            const lastKey = nonModifierKeys[nonModifierKeys.length - 1];
            // KeyA → A, Digit1 → 1, F2 → F2
            const formattedKey = lastKey.replace("Key", "").replace("Digit", "");
            combo.push(formattedKey);
        }

        const pressed = combo.join("+");
        const correctAnswer = shuffled[index].a;

        if (pressed === correctAnswer) {
            document.getElementById("result").textContent = "✅ 正解！";
            document.getElementById("result").style.color = "lime";
            score++;
        } else {
            document.getElementById("result").innerHTM = `❌ 不正解。押したキー: ${pressed} <br> 正解: ${correctAnswer}`;
            document.getElementById("result").style.color = "pink";
        }

        index++;
        setTimeout(showQuestion, 2000);
        comboHistory = [];
    }
}

document.addEventListener("keydown", handleKeyDown);
document.addEventListener("keyup", handleKeyUp);
showQuestion();
</script>
</body>
</html>
